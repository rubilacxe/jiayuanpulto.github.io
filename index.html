<!DOCTYPE HTML>
<html>
<head>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
</head>

<head>
    <script type="text/javascript">
        $(document).ready(function() {
            $.ajax({
                url: "head.html",
                type: "GET",
                success: function(data){
                    $("#page_left").html(data);
                },
            });>
    </script>
</head>
    
<body>
    <div class="container">
        <div class="main_left">
            <div id="page_left"></div>
        </div>
        <div class="main_right">
            <div class="catalog">
                <div class="article" id="article">
                </div>
                <div id="pages">
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $.ajax({
                url: "left_main.html",
                type: "GET",
                success: function(data){
                    $("#page_left").html(data);
                },
            
            });
            
            $.ajax({
                url: "main.json",
                type: "GET",
                dataType: "json",
                success: function(data) {
                    data.posts.sort(function(a, b){
                        if (a.date > b.date)
                            return -1;
                        if (a.date < b.date)
                            return 1;
                        return 0;
                    });
                    var per = data.perpage;
                    var n = data.posts.length;
                    var num = Math.ceil(n/per);
                    var arr = [];
                    var tmp = [];
                    for (var i = 0; i < n; ++i) {
                        if (i != 0 && i % per == 0) {
                            arr.push(tmp)
                            tmp = [];
                        }
                        tmp.push(data.posts[i]);
                    }
                    if (tmp.length > 0)
                        arr.push(tmp);
                    var url = window.location.href;
                    var page = /page=([0-9]+)$/i.exec(window.location.href);
                    if (page)
                        page = page[1];
                    else
                        page = 1;
                    if (page > num)
                        page = 1;
                    var article = "<ul>";
                    for (var i = 0; i < arr[page-1].length; i++) {
                        article += '<li><font class="s_title">' + arr[page-1][i].s_title + '</font><a class="title" href="' + arr[page-1][i].path + '">' + arr[page-1][i].title +'</a></li>';
                    }
                    article += "</ul>";
                    $("#article").html(article);
                    if (num > 1) {
                        var pages = '<ul class="pages">Pages: ';
                        var pagenum = [];
                        if (num <= 10) {
                            for (var i = 1; i <= num; i++) {
                                pagenum.push(i);
                            }
                        }
                        else {
                            if (page <= 4 || page > (num-4)) {
                                for (var i = 1; i <= 5; i++) {
                                    pagenum.push(i);
                                }
                                pagenum.push("point");
                                for (var i = (num-4); i <= num; i++) {
                                    pagenum.push(i);
                                }
                            }
                            else {
                                pagenum.push(1);
                                pagenum.push("point");
                                pagenum.push(page-2);
                                pagenum.push(page-1);
                                pagenum.push(page);
                                pagenum.push(page+1);
                                pagenum.push(page+2);
                                pagenum.push("point");
                                pagenum.push(num);
                            }
                        }
                        for (var i = 0; i < pagenum.length; i++) {
                            if (pagenum[i] == "point")
                                pages += "...";
                            else {
                                if (page == pagenum[i])
                                    pages += '<li><span class="selected">'+ page +'</span></li>';
                                else
                                    pages += '<li><a href="http://jiayuanpulto.github.io?page='+ pagenum[i] +'">'+ pagenum[i] +'</a></li>';
                            }
                        }
                        pages += "</ul>";
                        $("#pages").html(pages);
                    }
                },
                error: function(e) {
                    console.log("init error");
                }
            });
        });
    </script>
</body>
</html>
